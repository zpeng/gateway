/*
  backgrid-select-all
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,t,i,n,c){var o=c.Extension.SelectRowCell=n.View.extend({className:"select-row-cell",tagName:"td",events:{"change :checkbox":"onChange"},initialize:function(e){this.column=e.column,this.column instanceof c.Column||(this.column=new c.Column(this.column)),this.listenTo(this.model,"backgrid:select",function(e,t){this.$el.find(":checkbox").prop("checked",t).change()})},onChange:function(e){this.model.trigger("backgrid:selected",this.model,t(e.target).prop("checked"))},render:function(){return this.$el.empty().append('<input type="checkbox" />'),this.delegateEvents(),this}}),l=c.Extension.SelectAllHeaderCell=o.extend({className:"select-all-header-cell",tagName:"th",initialize:function(e){this.column=e.column,this.column instanceof c.Column||(this.column=new c.Column(this.column));var t=this.collection,i=this.selectedModels={};this.listenTo(t,"backgrid:selected",function(e,t){t?i[e.id||e.cid]=e:(delete i[e.id||e.cid],this.$el.find(":checkbox").prop("checked",!1))}),this.listenTo(t,"remove",function(e){delete i[e.cid]}),this.listenTo(n,"backgrid:refresh",function(){this.$el.find(":checkbox").prop("checked",!1);for(var e=0;t.length>e;e++){var n=t.at(e);i[n.id||n.cid]&&n.trigger("backgrid:select",n,!0)}})},onChange:function(e){var i=t(e.target).prop("checked"),n=this.collection;n.each(function(e){e.trigger("backgrid:select",e,i)})}});c.Grid.prototype.getSelectedModels=function(){for(var e,t=this.header.row.cells,i=0,n=t.length;n>i;i++){var c=t[i];if(c instanceof l){e=c;break}}var o=[];if(e)for(var s in e.selectedModels)o.push(this.collection.get(s));return o}})(window,jQuery,_,Backbone,Backgrid);